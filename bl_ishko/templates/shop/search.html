{% extends 'shop/base.html' %}

{% load static %}
{% load sort_size %}

{% load thumbnail %}
{% load mathfilters %}

{% block title %}Поиск{% endblock title %}

{% block header %}
  {% include 'shop/includes/header-light.html' %}
{% endblock header %}


{% block content %}
  <!-- CONTENT START -->
  <div class="content"> 
    
    <!--======= SUB BANNER =========-->
    <section class="sub-banner animate fadeInUp" data-wow-delay="0.4s">
      <div class="container">
        <h4>ПОИСК</h4>
        <!-- Breadcrumb -->
        <ol class="breadcrumb">
          <li><a href="{% url 'shop:home-page' %}">ГЛАВНАЯ</a></li>
          <li class="active">ПОИСК</li>
        </ol>
      </div>
    </section>
    
    <!--======= PAGES INNER =========-->
    <section class="section-p-30px pages-in">
      <div class="container">
        <div class="row"> 
          <!--======= ITEMS =========-->
          <div class="col-sm-12 animate fadeInUp" data-wow-delay="0.4s">
            <div class="items-short-type animate fadeInUp" data-wow-delay="0.4s"> 
              
              <!--======= GRID LIST STYLE =========-->
              <!-- <div class="grid-list"> <a href="#."><i class="fa fa-th-large"></i></a> <a href="#."><i class="fa fa-th-list"></i></a> </div> -->
              
              <!--======= SHORT BY =========-->
              <div class="short-by">
                {% if products %}
                  <p style="margin-left: 0;">Показаны 1-{{ products.count }} товаров</p>
                {% else %}
                  <p style="margin-left: 0;">Показано 0 товаров</p>
                {% endif %}
              </div>
              
              <!--======= VIEW ITEM NUMBER =========-->
              <div class="view-num">
                  <ul>
                    <li><a href="{% url 'shop:shop-page' %}">Все товары</a></li>
                  </ul>
              </div>
            </div>
            
            <!--======= Products =========-->
            <div class="popurlar_product animate fadeInUp" data-wow-delay="0.4s">
              <ul class="row">
                <li class="col-sm-12 animate fadeIn" data-wow-delay="0.2s">
                  {% if searched_title %}
                    <h5 style="font-size: 13px; font-weight: 300;">Результаты поиска по запросу: "{{ searched_title }}" {% if searched_category %}и категории "{{ searched_category }}"{% else %}и всем категориям{% endif %} </h5>
                  {% else %}
                    <h5 style="font-size: 13px; font-weight: 300;">Показаны все товары</h5>
                  {% endif %}
                </li>

                {% if not products %}
                  <li class="col-sm-4"></li>
                  <li class="col-sm-4" style="text-align: center; margin-top: 80px; margin-bottom: 150px;">
                    <svg data-v-00947247="" data-v-882e5e5a="" xmlns="http://www.w3.org/2000/svg" fill="#887569" height="39" width="39" viewBox="0 0 39 39" class="icon" data-v-71accff7="" style="height: 40px; width: 40px;"> <path data-v-00947247="" d="M6.42384 22.9098L6.62246 23.1481C9.38317 26.461 14.5126 26.3296 17.1 22.8797L15.9 21.9797C13.8935 24.655 9.91569 24.757 7.77479 22.1879L7.57617 21.9495L6.42384 22.9098Z"></path> <path data-v-00947247="" d="M22.1225 23.1481L21.9238 22.9098L23.0762 21.9495L23.2748 22.1879C25.4157 24.757 29.3935 24.655 31.4 21.9797L32.6 22.8797C30.0126 26.3296 24.8832 26.461 22.1225 23.1481Z"></path> <path data-v-00947247="" d="M15.5 31.1797V32.6797H23.5V31.1797H15.5Z"></path> <path data-v-00947247="" d="M13.5303 13.96L13.2319 14.2585C11.039 16.4513 8.16508 17.8326 5.08282 18.1751L4.91718 16.6843C7.6609 16.3794 10.2192 15.1498 12.1712 13.1978L12.4697 12.8994L13.5303 13.96Z"></path> <path data-v-00947247="" d="M26.2681 14.2585L25.9697 13.96L27.0303 12.8994L27.3288 13.1978C29.2808 15.1498 31.8391 16.3794 34.5828 16.6843L34.4172 18.1751C31.3349 17.8326 28.461 16.4513 26.2681 14.2585Z"></path> <path data-v-00947247="" fill-rule="evenodd" clip-rule="evenodd" d="M38.5 19.9297C38.5 30.4231 29.9934 38.9297 19.5 38.9297C9.00659 38.9297 0.5 30.4231 0.5 19.9297C0.5 9.43628 9.00659 0.929688 19.5 0.929688C29.9934 0.929688 38.5 9.43628 38.5 19.9297ZM37 19.9297C37 29.5947 29.165 37.4297 19.5 37.4297C9.83502 37.4297 2 29.5947 2 19.9297C2 10.2647 9.83502 2.42969 19.5 2.42969C29.165 2.42969 37 10.2647 37 19.9297Z"></path></svg>
                    <h5 style="font-size: 20px; font-weight: 300;">Ничего не нашлось</h5>
                    <h5 style="font-size: 13px; font-weight: 300;">Проверьте, правильно ли введен запрос</h5>
                  </li>
                  
                {% endif %}

                {% for product in products %}
                <!-- New Products -->
                <li class="col-sm-3 animate fadeIn" data-wow-delay="0.2s">
                  <div class="items-in">
                    
                    <!-- Image --> 
                    {% thumbnail product.title_image "270x340" crop="center" as im %}
                      <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="" class="related-produts-item-image">
                    {% endthumbnail %}

                    <!-- Hover Details -->
                    <div class="over-item">
                    <!--  Tags  -->
                    {% if product.discount %}
                      <div class="hot-tag">-{{ product.discount }}%</div>
                    {% endif %}

                      <ul class="animated fadeIn">
                        {% thumbnail product.title_image "378x476" crop="center" as im %}
                          <li> <a href="{{ im.url }}" data-lighter><i class="ion-search"></i></a></li>
                        {% endthumbnail %}
                        <li> <a href="" id="share-product1" data-toggle="modal" data-target="#shareModal"><i class="ion-shuffle"></i></a></li>
                        <input id="share-input" hidden="true" value="{{ product.get_absolute_url }}">
                        {% if request.user.is_authenticated %}
                          {% if product not in wish_list_products %}
                            <li> <a href="" class="wishlist-status" data-domain="{{ domain_url }}" data-product="{{ product.id }}" data-action="add-item"><i class="fa fa-heart-o"></i></a></li>
                          {% else %}
                            <li> <a href="" class="wishlist-status" data-domain="{{ domain_url }}" data-product="{{ product.id }}" data-action="delete-item" style="background: #af5875; color: #fff;"><i class="fa fa-heart-o"></i></a></li>
                          {% endif %}
                        {% else %}
                          <li> <a href="{% url 'account_login' %}"><i class="fa fa-heart-o"></i></a></li>
                        {% endif %}
                        <li class="full-w"> <a href="" data-toggle="modal" data-target="#choiceModal{{ forloop.counter }}" class="btn">В КОРЗИНУ</a></li>
                      </ul>
                    </div>
                    <!-- Item Name -->
                    <div class="details-sec"> <a href="{{ product.get_absolute_url }}">{{ product.title|upper }}</a> <span class="font-montserrat" style="text-decoration: line-through;">{% if product.discount %}{{ product.price }}{% endif %}</span> <span class="font-montserrat">{{ product.get_price }} RUB</span> </div>
                  </div>
                </li>
                {% endfor %}
              </ul>
            </div>
            
            <!--======= PAGINATION =========-->
<!--             <ul class="pagination animate fadeInUp" data-wow-delay="0.4s">
              <li><a href="#.">1</a></li>
              <li><a href="#.">2</a></li>
              <li><a href="#.">3</a></li>
              <li><a href="#.">4</a></li>
              <li><a href="#.">5</a></li>
              <li><a href="#."><i class="fa fa-angle-right"></i></a></li>
            </ul -->
            <ul class="pagination animate fadeInUp" data-wow-delay="0.4s" style="border-bottom: none; border-top: none;"></ul>
          </div>
        </div>
      </div>
    </section>
  </div>

{% for product in products %}
<!-- Modal window -->
  <div class="modal fade modal-adaptation" id="choiceModal{{ forloop.counter }}" tabindex="-1" role="dialog" aria-labelledby="choiceModal{{ forloop.counter }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-adaptation-content" role="document" style="position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%);">
      <div class="modal-content">
        <div class="modal-body" style="background-color: #fff; border-radius: 4px; padding: 20px;">
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <section class="pages-in item-detail-page">
            <form action="{% url 'cart:add-to-cart' product.id %}" method="GET">
                <!-- size -->
                <div class="col-sm-12">
                  <div class="item-select"> 
                    <!--  SIZE -->
                    <p>*РАЗМЕР</p>
                    <select class="selectpicker" id='product-size'>
                      {% if product.items.all|distinct_size %}
                        {% for size in product.items.all|distinct_size %}
                          <option>{{ size }}</option>
                        {% endfor %}
                      {% else %}
                        <option disabled>ТОВАР ОТСУТСТВУЕТ</option>
                      {% endif %}
                    </select>
                    <input type="" id="size_input" hidden="true" name="size" value="{{ product.items.all|distinct_size|first }}">
                  </div>
                </div>

                <div class="col-sm-12">
                  <p style="font-size: 12px; margin-top: 10px">{{ product.description }}</p>
                </div>

                <div class="col-sm-12">
                  <p style="font-size: 12px; margin-top: 10px">Состав: {{ product.compound }}</p>
                </div> 

                <div class="col-sm-12">
                  <p style="font-size: 12px; margin-top: 10px">Уход: {{ product.care }}</p>
                </div> 
                {% if product.items.all|distinct_size %}
                  <div class="col-sm-12">
                    <button type="submit" class="btn btn-small btn-dark float-right">В КОРЗИНУ</button>
                  </div>
                {% endif %}
            </form>
          </section>
        </div>
      </div>
    </div>
  </div>
<!-- end Modal window -->


<!-- Modal window share product -->
<div class="modal fade modal-adaptation" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-adaptation-content" role="document" style="position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%);">
    <div class="modal-content">
      <div class="modal-body" style="background-color: #fff; border-radius: 4px; padding: 20px;">
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="col">
          <h6 style="font-weight: 500; font-family: 'Montserrat', sans-serif;">ПОДЕЛИТЬСЯ</h6>
        </div>
        
        <div class="col">
          <p style="font-size: 11px; font-family: 'Montserrat', sans-serif;">Ссылка на товар скопирована в буфер обмена.</p>
        </div>

      </div>
    </div>
  </div>
</div>
<!-- end Modal window -->
{% endfor %}
{% endblock content %}


{% block scripts %}
<script src="{% static 'js/jquery-1.11.3.js' %}"></script> 
<script src="{% static 'js/wow.min.js' %}"></script> 
<script src="{% static 'js/bootstrap.min.js' %}"></script> 
<script src="{% static 'js/own-menu.js' %}"></script> 
<script src="{% static 'js/owl.carousel.min.js' %}"></script> 
<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script> 
<script src="{% static 'js/jquery.isotope.min.js' %}"></script> 
<script src="{% static 'js/jquery.nouislider.min.js' %}"></script> 
<script src="{% static 'js/jquery.flexslider-min.js' %}"></script> 

<!-- SLIDER REVOLUTION 4.x SCRIPTS  --> 
<script type="text/javascript" src="{% static 'rs-plugin/js/jquery.themepunch.tools.min.js' %}"></script> 
<script type="text/javascript" src="{% static 'rs-plugin/js/jquery.themepunch.revolution.min.js' %}"></script> 
<script src="{% static 'js/main.js' %}"></script>
<script src="{% static 'js/wishlist.js' %}"></script> 
<script>
jQuery(document).ready(function($) {
  
  //  Price Filter ( noUiSlider Plugin)
    $("#price-range").noUiSlider({
    range: {
      'min': [ 0 ],
      'max': [ 1000 ]
    },
    start: [40, 940],
        connect:true,
        serialization:{
            lower: [
        $.Link({
          target: $("#price-min")
        })
      ],
      upper: [
        $.Link({
          target: $("#price-max")
        })
      ],
      format: {
      // Set formatting
        decimals: 2,
        prefix: '$'
      }
        }
  })
})

</script>
{% endblock scripts %}